<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SongShare - Universal Music Links</title>
    <meta name="description" content="Convert any music link to a universal page with links for all streaming platforms">

    <!-- PWA / iOS Share Sheet Support -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SongShare">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#1a1a2e">

    <!-- Share Target API registration -->
    <meta name="share-target" content="true">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 40px 0;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tagline {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .input-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        #songUrl {
            flex: 1;
            min-width: 200px;
            padding: 15px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        #songUrl:focus {
            outline: none;
            border-color: #e94560;
        }

        #songUrl::placeholder {
            color: #666;
        }

        button {
            padding: 15px 30px;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .supported-platforms {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .platform-badge {
            padding: 5px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.8rem;
            color: #a0a0a0;
        }

        /* Results Section */
        #results {
            display: none;
        }

        #results.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .song-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .song-artwork {
            width: 100px;
            height: 100px;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .song-details h2 {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .song-details .artist {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .platform-links {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .platform-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            text-decoration: none;
            color: #fff;
            transition: background 0.3s, transform 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .platform-link:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .platform-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
        }

        .platform-name {
            font-weight: 500;
        }

        .share-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .share-section h3 {
            margin-bottom: 15px;
            color: #a0a0a0;
            font-weight: 500;
        }

        .share-url {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        #shareLink {
            flex: 1;
            min-width: 200px;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 0.9rem;
        }

        .copy-btn, .share-btn {
            padding: 12px 20px;
            font-size: 0.9rem;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.1);
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: none;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #e94560;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error State */
        .error {
            background: rgba(233, 69, 96, 0.1);
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            color: #ff6b6b;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: #fff;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 500px) {
            h1 {
                font-size: 2rem;
            }

            .song-info {
                flex-direction: column;
                text-align: center;
            }

            .input-wrapper {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        footer a {
            color: #e94560;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽµ SongShare</h1>
            <p class="tagline">Share music with everyone, regardless of their streaming platform</p>
        </header>

        <section class="input-section">
            <div class="input-wrapper">
                <input
                    type="url"
                    id="songUrl"
                    placeholder="Paste a Spotify, Apple Music, or any music link..."
                    autocomplete="off"
                >
                <button id="convertBtn" onclick="convertLink()">Convert</button>
            </div>
            <div class="supported-platforms">
                <span class="platform-badge">Spotify</span>
                <span class="platform-badge">Apple Music</span>
                <span class="platform-badge">Tidal</span>
                <span class="platform-badge">Deezer</span>
                <span class="platform-badge">Amazon Music</span>
            </div>
        </section>

        <section id="results"></section>
    </div>

    <div class="toast" id="toast"></div>

    <footer>
        <p>Powered by <a href="https://odesli.co" target="_blank">Odesli</a> API</p>
    </footer>

    <script>
        // Platform display names and colors
        const platformInfo = {
            spotify: { name: 'Spotify', color: '#1DB954', icon: 'https://upload.wikimedia.org/wikipedia/commons/8/84/Spotify_icon.svg' },
            appleMusic: { name: 'Apple Music', color: '#FC3C44', icon: 'https://upload.wikimedia.org/wikipedia/commons/5/5f/Apple_Music_icon.svg' },
            tidal: { name: 'Tidal', color: '#000000', icon: 'https://upload.wikimedia.org/wikipedia/commons/e/e5/Tidal_%28service%29_logo.svg' },
            deezer: { name: 'Deezer', color: '#FEAA2D', icon: 'https://upload.wikimedia.org/wikipedia/commons/e/e5/Deezer_logo.svg' },
            amazonMusic: { name: 'Amazon Music', color: '#00A8E1', icon: 'https://upload.wikimedia.org/wikipedia/commons/8/82/Amazon_Music_logo.svg' },
            youtube: { name: 'YouTube', color: '#FF0000', icon: 'https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg' },
            youtubeMusic: { name: 'YouTube Music', color: '#FF0000', icon: 'https://upload.wikimedia.org/wikipedia/commons/6/6a/Youtube_Music_icon.svg' },
            soundcloud: { name: 'SoundCloud', color: '#FF5500', icon: 'https://upload.wikimedia.org/wikipedia/commons/a/a2/Antu_soundcloud.svg' },
            pandora: { name: 'Pandora', color: '#3668FF', icon: 'https://upload.wikimedia.org/wikipedia/commons/5/50/Pandora_P_logo.svg' },
        };

        // Priority order for displaying platforms
        const platformOrder = ['spotify', 'appleMusic', 'tidal', 'deezer', 'amazonMusic', 'youtubeMusic', 'youtube', 'soundcloud', 'pandora'];

        // Check for shared URL on page load (for iOS Share Sheet)
        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const sharedUrl = params.get('url') || params.get('text');
            if (sharedUrl) {
                document.getElementById('songUrl').value = sharedUrl;
                convertLink();
            }
        });

        // Handle Enter key
        document.getElementById('songUrl').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') convertLink();
        });

        async function convertLink() {
            const urlInput = document.getElementById('songUrl');
            const resultsDiv = document.getElementById('results');
            const btn = document.getElementById('convertBtn');

            let url = urlInput.value.trim();

            // Extract URL if text contains other content (like from share sheet)
            const urlMatch = url.match(/https?:\/\/[^\s]+/);
            if (urlMatch) {
                url = urlMatch[0];
                urlInput.value = url;
            }

            if (!url) {
                showToast('Please enter a music link');
                return;
            }

            // Show loading state
            btn.disabled = true;
            btn.textContent = 'Converting...';
            resultsDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Finding your song on all platforms...</p>
                </div>
            `;
            resultsDiv.classList.add('visible');

            try {
                const encodedUrl = encodeURIComponent(url);
                const response = await fetch(`https://api.song.link/v1-alpha.1/links?url=${encodedUrl}`);

                if (!response.ok) {
                    throw new Error('Could not find this song. Please check the link and try again.');
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <p>ðŸ˜• ${error.message}</p>
                        <p style="margin-top: 10px; font-size: 0.9rem; color: #a0a0a0;">
                            Make sure you're using a valid link from a supported streaming platform.
                        </p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Convert';
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');

            // Get song info from the first available entity
            const entities = Object.values(data.entitiesByUniqueId || {});
            const songEntity = entities[0] || {};

            const title = songEntity.title || 'Unknown Title';
            const artist = songEntity.artistName || 'Unknown Artist';
            const artwork = songEntity.thumbnailUrl || '';

            // Build platform links HTML
            let platformLinksHtml = '';
            const links = data.linksByPlatform || {};

            // Sort by our preferred order, then add any remaining platforms
            const sortedPlatforms = [
                ...platformOrder.filter(p => links[p]),
                ...Object.keys(links).filter(p => !platformOrder.includes(p))
            ];

            for (const platform of sortedPlatforms) {
                const link = links[platform];
                if (!link) continue;

                const info = platformInfo[platform] || {
                    name: platform.charAt(0).toUpperCase() + platform.slice(1).replace(/([A-Z])/g, ' $1'),
                    color: '#666',
                    icon: ''
                };

                const iconHtml = info.icon
                    ? `<img src="${info.icon}" alt="" class="platform-icon" onerror="this.style.display='none'">`
                    : `<div class="platform-icon" style="background: ${info.color}; border-radius: 6px;"></div>`;

                platformLinksHtml += `
                    <a href="${link.url}" target="_blank" rel="noopener" class="platform-link">
                        ${iconHtml}
                        <span class="platform-name">${info.name}</span>
                    </a>
                `;
            }

            const shareUrl = data.pageUrl || '';

            resultsDiv.innerHTML = `
                <div class="song-info">
                    ${artwork ? `<img src="${artwork}" alt="Album artwork" class="song-artwork">` : ''}
                    <div class="song-details">
                        <h2>${escapeHtml(title)}</h2>
                        <p class="artist">${escapeHtml(artist)}</p>
                    </div>
                </div>

                <div class="platform-links">
                    ${platformLinksHtml}
                </div>

                <div class="share-section">
                    <h3>Share this universal link</h3>
                    <div class="share-url">
                        <input type="text" id="shareLink" value="${shareUrl}" readonly>
                        <button class="copy-btn" onclick="copyLink()">Copy</button>
                        ${navigator.share ? '<button class="share-btn" onclick="shareLink()">Share</button>' : ''}
                    </div>
                </div>
            `;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyLink() {
            const shareLink = document.getElementById('shareLink');
            shareLink.select();
            navigator.clipboard.writeText(shareLink.value)
                .then(() => showToast('Link copied to clipboard!'))
                .catch(() => showToast('Failed to copy link'));
        }

        function shareLink() {
            const shareLink = document.getElementById('shareLink').value;
            const songInfo = document.querySelector('.song-details h2');
            const title = songInfo ? songInfo.textContent : 'Check out this song';

            navigator.share({
                title: title,
                text: 'Listen on your favorite platform:',
                url: shareLink
            }).catch(() => {});
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {});
        }
    </script>
</body>
</html>
